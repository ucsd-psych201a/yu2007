<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Word Learning Game</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #cfd9df, #e2ebf0);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100%;
      overflow-x: hidden;
      color: #333;
    }

    .jspsych-display-element {
      max-width: 100%;
      text-align: center;
      padding: 50px;
      background: #ffffff;
      box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      transition: transform 0.3s ease;
      position: relative;
      overflow: hidden;
      width: 100%;
    }

    .jspsych-display-element:hover {
      transform: scale(1.02);
    }

    .jspsych-html-keyboard-response-stimulus {
      font-size: 1.4em;
      color: #4a4a4a;
      line-height: 1.8;
      margin-bottom: 1.5em;
      text-align: center;
      width: 100%;
    }

    .typing-effect {
      white-space: nowrap;
      overflow: hidden;
      border-right: 2px solid black; 
      display: inline-block;
      width: 0; 
      animation: typing 5s steps(40, end) forwards, blink 0.8s step-end infinite;
    }

    @keyframes typing {
      from {
        width: 0;
      }

      to {
        width: 100%;
      }
    }

    @keyframes blink {
      from,
      to {
        border-color: transparent;
      }

      50% {
        border-color: #4a4a4a;
      }
    }

    .press-any-key {
      opacity: 0;
      font-weight: bold;
      margin-top: 20px;
      transition: opacity 0.5s ease;
    }

    .image-container {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 20px;
      gap: 80px;
      width: 100%;
      flex-wrap: wrap;
    }

    .image-container img {
      width: 300px;
      height: auto;
      border-radius: 8px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
    }

    .image-container img:hover {
      transform: scale(1.05);
      box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.15);
    }

    .timer {
      font-size: 2em;
      color: #333;
      margin-top: 10px;
    }

    .countdown-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
      position: fixed;
      top: 0;
      left: 0;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 8em;
      font-weight: bold;
      z-index: 100;
    }
  </style>
</head>

<body>
  <script>
    var jsPsych = initJsPsych({
      override_safe_mode: true
    });

    var timeline = [];

    var welcome = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div class="jspsych-html-keyboard-response-stimulus">
          <p>Welcome to the experiment.</p>
          <p>Press any key to begin.</p>
          <div class="press-any-key">Press any key to begin</div>
        </div>
      `,
    };
    timeline.push(welcome);

    var instructions = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div class="jspsych-html-keyboard-response-stimulus">
          <p id="line1"></p>
          <p id="line2"></p>
          <p id="line3"></p>
          <p id="line4"></p>
          <p id="line5"></p>
          <p id="line6"></p>
          <p id="line7"></p>
          <div class="press-any-key" style="opacity: 0;">Press any key to begin</div>
        </div>
     `,
      on_load: function () {
        const lines = [
          "You will view pairs of images and pseudo-word audios across three conditions: 2x2, 3x3, and 4x4.",
          "Your goal is to learn which word matches each image.",
          "There won't be direct hints, but repetition will help you infer the correct matches.",
          "Each trial lasts 6，9，12 seconds through 3 conditions and changes automatically.",
          "After each condition, you will take a brief test to match images to words.",
          "You're now in the 2x2 condition with 54 trials.",
          "Each trial will display 2 images and 2 words for 6 seconds."
        ];
        
        const typingSpeed = 50;
        const sentenceDelay = 200;  // Define a delay between sentences

        function typeLine(lineIndex) {
          if (lineIndex < lines.length) {
            const element = document.getElementById('line' + (lineIndex + 1));
            let i = 0;
            const typingInterval = setInterval(() => {
              element.textContent += lines[lineIndex][i];
              i++;
              if (i === lines[lineIndex].length) {
                clearInterval(typingInterval);
                element.classList.remove('typing-effect');
                setTimeout(() => {
                  typeLine(lineIndex + 1); // Type the next line with a delay
                }, sentenceDelay);
              }
            }, typingSpeed);
          } else {
            document.querySelector('.press-any-key').style.opacity = 1;
          }
        }

        setTimeout(() => {
          typeLine(0); // Start typing the first line
        }, 500);
      }
    };
    timeline.push(instructions);

    var preload = {
      type: jsPsychPreload,
      images: [
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/4f3e5673cdbf327215f437a8effd602cbbd90a6b/stimuli/condition1/image/img/1.bmp",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/4f3e5673cdbf327215f437a8effd602cbbd90a6b/stimuli/condition1/image/img/2.bmp"
      ],
      audio: [
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/4f3e5673cdbf327215f437a8effd602cbbd90a6b/stimuli/condition1/audio/audio/1.wav",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/37eb1fbf9429cc66a5474473abf6ffdd88dde6a1/stimuli/condition1/audio/audio/2.wav"
      ]
    };
    timeline.push(preload);

    var countdown_3 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">3</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };

    var countdown_2 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">2</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };

    var countdown_1 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">1</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };

    const imageBaseURL = "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/b64ea5ec2ad7449f8dc4c0fa72a01a3b8ba3141c/stimuli/condition1/image/img/";
    const audioBaseURL = "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/b64ea5ec2ad7449f8dc4c0fa72a01a3b8ba3141c/stimuli/condition1/audio/audio/";
    const fileExtensionImage = ".bmp";
    const fileExtensionAudio = ".wav";

    // Function to shuffle array
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]; // Swap elements
      }
    }

    // Function to create image-audio trial
    function createImageAudioTrial(image_a, image_b, audio_a, audio_b) {
      var images = [image_a, image_b];
      var audios = [audio_a, audio_b];
      shuffleArray(images);
      shuffleArray(audios);

      var preload = {
        type: jsPsychPreload,
        images: images,
        audio: audios
      };

      var imageAudioTrial = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
          <div class="image-container">
            <img src="${images[0]}" alt="Image 1">
            <img src="${images[1]}" alt="Image 2">
          </div>
          <div class="timer">Time Remaining: <span id="timer">6</span> seconds</div>
          <audio id="audio_a">
            <source src="${audios[0]}">
          </audio>
          <audio id="audio_b">
            <source src="${audios[1]}">
          </audio>
         `
        ,
        choices: "NO_KEYS",
        trial_duration: 6000,
        on_load: () => {
          const audio_a = document.getElementById('audio_a');
          const audio_b = document.getElementById('audio_b');
          const timerElement = document.getElementById('timer');
          let startTime = Date.now();
          let timeRemaining = 6;

          const timerInterval = setInterval(() => {
            let currentTime = Date.now();
            let elapsedTime = Math.floor((currentTime - startTime) / 1000);
            timeRemaining = 6 - elapsedTime;
            timerElement.textContent = timeRemaining;
            if (timeRemaining <= 0) {
              clearInterval(timerInterval);
            }
          }, 1000);

          audio_a.play();
          audio_a.onended = function () {
            setTimeout(function () {
              audio_b.play(); // Play the second audio after a delay
            }, 1000);
          };

          // Error handling for audio playback
          audio_a.onerror = () => console.log("Error playing audio_a");
          audio_b.onerror = () => console.log("Error playing audio_b");
        }
      };
      return [preload, imageAudioTrial];
    }

    // Trial mappings
    const trialMappings = [
    { trial: 10, imageA: 1, imageB: 3, audioA: 1, audioB: 3 },
  { trial: 11, imageA: 2, imageB: 4, audioA: 2, audioB: 4 },
  { trial: 12, imageA: 5, imageB: 7, audioA: 5, audioB: 7 },
  { trial: 13, imageA: 6, imageB: 8, audioA: 6, audioB: 8 },
  { trial: 14, imageA: 9, imageB: 11, audioA: 9, audioB: 11 },
  { trial: 15, imageA: 10, imageB: 12, audioA: 10, audioB: 12 },
  { trial: 16, imageA: 13, imageB: 15, audioA: 13, audioB: 15 },
  { trial: 17, imageA: 14, imageB: 16, audioA: 14, audioB: 16 },
  { trial: 18, imageA: 17, imageB: 1, audioA: 17, audioB: 1 },
  { trial: 19, imageA: 2, imageB: 3, audioA: 2, audioB: 3 },
  { trial: 20, imageA: 4, imageB: 5, audioA: 4, audioB: 5 },
  { trial: 21, imageA: 6, imageB: 7, audioA: 6, audioB: 7 },
  { trial: 22, imageA: 8, imageB: 9, audioA: 8, audioB: 9 },
  { trial: 23, imageA: 10, imageB: 11, audioA: 10, audioB: 11 },
  { trial: 24, imageA: 12, imageB: 13, audioA: 12, audioB: 13 },
  { trial: 25, imageA: 14, imageB: 15, audioA: 14, audioB: 15 },
  { trial: 26, imageA: 16, imageB: 17, audioA: 16, audioB: 17 },
  { trial: 27, imageA: 18, imageB: 1, audioA: 18, audioB: 1 },
  { trial: 28, imageA: 2, imageB: 5, audioA: 2, audioB: 5 },
  { trial: 29, imageA: 3, imageB: 6, audioA: 3, audioB: 6 },
  { trial: 30, imageA: 4, imageB: 7, audioA: 4, audioB: 7 },
  { trial: 31, imageA: 8, imageB: 10, audioA: 8, audioB: 10 },
  { trial: 32, imageA: 9, imageB: 12, audioA: 9, audioB: 12 },
  { trial: 33, imageA: 11, imageB: 13, audioA: 11, audioB: 13 },
  { trial: 34, imageA: 14, imageB: 16, audioA: 14, audioB: 16 },
  { trial: 35, imageA: 15, imageB: 17, audioA: 15, audioB: 17 },
  { trial: 36, imageA: 18, imageB: 2, audioA: 18, audioB: 2 },
  { trial: 37, imageA: 3, imageB: 5, audioA: 3, audioB: 5 },
  { trial: 38, imageA: 6, imageB: 8, audioA: 6, audioB: 8 },
  { trial: 39, imageA: 9, imageB: 11, audioA: 9, audioB: 11 },
  { trial: 40, imageA: 12, imageB: 14, audioA: 12, audioB: 14 },
  { trial: 41, imageA: 15, imageB: 18, audioA: 15, audioB: 18 },
  { trial: 42, imageA: 1, imageB: 4, audioA: 1, audioB: 4 },
  { trial: 43, imageA: 5, imageB: 7, audioA: 5, audioB: 7 },
  { trial: 44, imageA: 8, imageB: 10, audioA: 8, audioB: 10 },
  { trial: 45, imageA: 11, imageB: 13, audioA: 11, audioB: 13 },
  { trial: 46, imageA: 16, imageB: 18, audioA: 16, audioB: 18 },
  { trial: 47, imageA: 1, imageB: 6, audioA: 1, audioB: 6 },
  { trial: 48, imageA: 3, imageB: 9, audioA: 3, audioB: 9 },
  { trial: 49, imageA: 5, imageB: 11, audioA: 5, audioB: 11 },
  { trial: 50, imageA: 7, imageB: 13, audioA: 7, audioB: 13 },
  { trial: 51, imageA: 10, imageB: 15, audioA: 10, audioB: 15 },
  { trial: 52, imageA: 12, imageB: 16, audioA: 12, audioB: 16 },
  { trial: 53, imageA: 14, imageB: 18, audioA: 14, audioB: 18 },
  { trial: 54, imageA: 2, imageB: 8, audioA: 2, audioB: 8 }
    ];

    // Randomize trial order
    const randomizedTrials = trialMappings.sort(() => Math.random() - 0.5);

    // Push randomized trials to the timeline
    for (let i = 0; i < randomizedTrials.length; i++) {
      const { imageA, imageB, audioA, audioB } = randomizedTrials[i];
      let imageAURL = `${imageBaseURL}${imageA}${fileExtensionImage}`;
      let imageBURL = `${imageBaseURL}${imageB}${fileExtensionImage}`;
      let audioAURL = `${audioBaseURL}${audioA}${fileExtensionAudio}`;
      let audioBURL = `${audioBaseURL}${audioB}${fileExtensionAudio}`;

      timeline.push(...createImageAudioTrial(imageAURL, imageBURL, audioAURL, audioBURL));
    }

    // CONDITION 2
    var instructions2 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div class="jspsych-html-keyboard-response-stimulus">
          <p id="line1"></p>
          <p id="line2"></p>
          <p id="line3"></p>
          <div class="press-any-key" style="opacity: 0;">Press any key to begin</div>
        </div>
        `
      ,
      on_load: function () {
        const lines = [
          "Well Done!Take a break.",
          "You're now in the 3x3 condition with 36 trials.",
          "Each trial will display 3 images and 3 words for 9 seconds."
        ];
        
        const typingSpeed = 50;
        const sentenceDelay = 200;  // Define a delay between sentences

        function typeLine(lineIndex) {
          if (lineIndex < lines.length) {
            const element = document.getElementById('line' + (lineIndex + 1));
            let i = 0;
            const typingInterval = setInterval(() => {
              element.textContent += lines[lineIndex][i];
              i++;
              if (i === lines[lineIndex].length) {
                clearInterval(typingInterval);
                element.classList.remove('typing-effect');
                setTimeout(() => {
                  typeLine(lineIndex + 1); // Type the next line with a delay
                }, sentenceDelay);
              }
            }, typingSpeed);
          } else {
            document.querySelector('.press-any-key').style.opacity = 1;
          }
        }

        setTimeout(() => {
          typeLine(0); // Start typing the first line
        }, 500);
      }
    };
    timeline.push(instructions2);

    const imageBaseURL2 = "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/image/";
    const audioBaseURL2 = "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/audio/";
    const fileExtensionImage2 = ".jpg";
    const fileExtensionAudio2 = ".mp3";

    var preload2 = {
      type: jsPsychPreload,
      images: [
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/image/1.jpg",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/image/3.jpg",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/image/5.jpg"
      ],
      audio: [
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/audio/1.mp3",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/audio/3.mp3",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition2/audio/5.mp3"
      ]
    };
    timeline.push(preload2);

    var countdown_3 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">3</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };

    var countdown_2 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">2</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };

    var countdown_1 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">1</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };
    timeline.push(countdown_3, countdown_2, countdown_1);

    function createImageAudioTrial2(image_a, image_b, image_c, audio_a, audio_b, audio_c) {
  var images = [image_a, image_b, image_c];
  var audios = [audio_a, audio_b, audio_c];
  shuffleArray(images);
  shuffleArray(audios);

  var preload = {
    type: jsPsychPreload,
    images: images,
    audio: audios
  };

  var imageAudioTrial2 = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <div class="image-container">
        <img src="${images[0]}" alt="Image 1">
        <img src="${images[1]}" alt="Image 2">
        <img src="${images[2]}" alt="Image 3">
      </div>
      <div class="timer">Time Remaining: <span id="timer">6</span> seconds</div>
      <audio id="audio_a">
        <source src="${audios[0]}" type="audio/mp3">
      </audio>
      <audio id="audio_b">
        <source src="${audios[1]}" type="audio/mp3">
      </audio>
      <audio id="audio_c">
        <source src="${audios[2]}" type="audio/mp3">
      </audio>
     `,
    choices: "NO_KEYS",
    trial_duration: 9000,
    on_load: () => {
      const audio_a = document.getElementById('audio_a');
      const audio_b = document.getElementById('audio_b');
      const audio_c = document.getElementById('audio_c');
      const timerElement = document.getElementById('timer');
      let startTime = Date.now();
      let timeRemaining = 9;

      const timerInterval = setInterval(() => {
        let currentTime = Date.now();
        let elapsedTime = Math.floor((currentTime - startTime) / 1000);
        timeRemaining = 9 - elapsedTime;
        timerElement.textContent = timeRemaining;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
        }
      }, 1000);

      audio_a.play();
      audio_a.onended = function () {
        setTimeout(function () {
          audio_b.play(); // Play the second audio after a delay
        }, 1000);
      };
      audio_b.onended = function () {
        setTimeout(function () {
          audio_c.play(); // Play the third audio after a delay
        }, 1000);
      };

      // Error handling for audio playback
      audio_a.onerror = () => console.log("Error playing audio_a");
      audio_b.onerror = () => console.log("Error playing audio_b");
      audio_c.onerror = () => console.log("Error playing audio_c");
    }
  };

  return [preload, imageAudioTrial2];
}

    const trialMappings2 = [
  { trial: 1,  imageA: 1,  imageB: 3,  imageC: 5,  audioA: 1,  audioB: 3,  audioC: 5 },
  { trial: 2,  imageA: 2,  imageB: 4,  imageC: 6,  audioA: 2,  audioB: 4,  audioC: 6 },
  { trial: 3,  imageA: 7,  imageB: 9,  imageC: 11, audioA: 7,  audioB: 9,  audioC: 11 },
  { trial: 4,  imageA: 8,  imageB: 10, imageC: 12, audioA: 8,  audioB: 10, audioC: 12 },
  { trial: 5,  imageA: 13, imageB: 15, imageC: 17, audioA: 13, audioB: 15, audioC: 17 },
  { trial: 6,  imageA: 14, imageB: 16, imageC: 18, audioA: 14, audioB: 16, audioC: 18 },
  { trial: 7,  imageA: 1,  imageB: 2,  imageC: 3,  audioA: 1,  audioB: 2,  audioC: 3 },
  { trial: 8,  imageA: 4,  imageB: 5,  imageC: 6,  audioA: 4,  audioB: 5,  audioC: 6 },
  { trial: 9,  imageA: 7,  imageB: 8,  imageC: 9,  audioA: 7,  audioB: 8,  audioC: 9 },
  { trial: 10, imageA: 10, imageB: 11, imageC: 12, audioA: 10, audioB: 11, audioC: 12 },
  { trial: 11, imageA: 13, imageB: 14, imageC: 15, audioA: 13, audioB: 14, audioC: 15 },
  { trial: 12, imageA: 16, imageB: 17, imageC: 18, audioA: 16, audioB: 17, audioC: 18 },
  { trial: 13, imageA: 1,  imageB: 4,  imageC: 7,  audioA: 1,  audioB: 4,  audioC: 7 },
  { trial: 14, imageA: 2,  imageB: 5,  imageC: 8,  audioA: 2,  audioB: 5,  audioC: 8 },
  { trial: 15, imageA: 3,  imageB: 6,  imageC: 9,  audioA: 3,  audioB: 6,  audioC: 9 },
  { trial: 16, imageA: 10, imageB: 13, imageC: 16, audioA: 10, audioB: 13, audioC: 16 },
  { trial: 17, imageA: 11, imageB: 14, imageC: 17, audioA: 11, audioB: 14, audioC: 17 },
  { trial: 18, imageA: 12, imageB: 15, imageC: 18, audioA: 12, audioB: 15, audioC: 18 },
  { trial: 19, imageA: 1,  imageB: 2,  imageC: 3,  audioA: 1,  audioB: 2,  audioC: 3 },
  { trial: 20, imageA: 4,  imageB: 5,  imageC: 6,  audioA: 4,  audioB: 5,  audioC: 6 },
  { trial: 21, imageA: 7,  imageB: 8,  imageC: 9,  audioA: 7,  audioB: 8,  audioC: 9 },
  { trial: 22, imageA: 10, imageB: 11, imageC: 12, audioA: 10, audioB: 11, audioC: 12 },
  { trial: 23, imageA: 13, imageB: 14, imageC: 15, audioA: 13, audioB: 14, audioC: 15 },
  { trial: 24, imageA: 16, imageB: 17, imageC: 18, audioA: 16, audioB: 17, audioC: 18 },
  { trial: 25, imageA: 1,  imageB: 3,  imageC: 5,  audioA: 1,  audioB: 3,  audioC: 5 },
  { trial: 26, imageA: 2,  imageB: 4,  imageC: 6,  audioA: 2,  audioB: 4,  audioC: 6 },
  { trial: 27, imageA: 7,  imageB: 9,  imageC: 11, audioA: 7,  audioB: 9,  audioC: 11 },
  { trial: 28, imageA: 8,  imageB: 10, imageC: 12, audioA: 8,  audioB: 10, audioC: 12 },
  { trial: 29, imageA: 13, imageB: 15, imageC: 17, audioA: 13, audioB: 15, audioC: 17 },
  { trial: 30, imageA: 14, imageB: 16, imageC: 18, audioA: 14, audioB: 16, audioC: 18 },
  { trial: 31, imageA: 1,  imageB: 2,  imageC: 3,  audioA: 1,  audioB: 2,  audioC: 3 },
  { trial: 32, imageA: 4,  imageB: 5,  imageC: 6,  audioA: 4,  audioB: 5,  audioC: 6 },
  { trial: 33, imageA: 7,  imageB: 8,  imageC: 9,  audioA: 7,  audioB: 8,  audioC: 9 },
  { trial: 34, imageA: 10, imageB: 11, imageC: 12, audioA: 10, audioB: 11, audioC: 12 },
  { trial: 35, imageA: 13, imageB: 14, imageC: 15, audioA: 13, audioB: 14, audioC: 15 },
  { trial: 36, imageA: 16, imageB: 17, imageC: 18, audioA: 16, audioB: 17, audioC: 18 }
];

    // Randomize trial order
    const randomizedTrials2 = trialMappings2.sort(() => Math.random() - 0.5);

    // Push randomized trials to the timeline
    for (let i = 0; i < randomizedTrials2.length; i++) {
      const { imageA, imageB, imageC ,audioA, audioB , audioC } = randomizedTrials2[i];
      let imageAURL2 = `${imageBaseURL2}${imageA}${fileExtensionImage2}`;
      let imageBURL2= `${imageBaseURL2}${imageB}${fileExtensionImage2}`;
      let imageCURL2= `${imageBaseURL2}${imageC}${fileExtensionImage2}`;
      let audioAURL2 = `${audioBaseURL2}${audioA}${fileExtensionAudio2}`;
      let audioBURL2 = `${audioBaseURL2}${audioB}${fileExtensionAudio2}`;
      let audioCURL2 = `${audioBaseURL2}${audioC}${fileExtensionAudio2}`;

      timeline.push(...createImageAudioTrial2(imageAURL2, imageBURL2, imageCURL2, audioAURL2, audioBURL2, audioCURL2));
    }

    // CONDITION 3
    var instructions3= {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div class="jspsych-html-keyboard-response-stimulus">
          <p id="line1"></p>
          <p id="line2"></p>
          <p id="line3"></p>
          <div class="press-any-key" style="opacity: 0;">Press any key to begin</div>
        </div>
      `,
      on_load: function () {
        const lines = [
          "Well Done!Take a break.",
          "You're now in the 4x4 condition with 27 trials.",
          "Each trial will display 4 images and 4 words for 12 seconds."
        ];
        
        const typingSpeed = 50;
        const sentenceDelay = 200;  // Define a delay between sentences

        function typeLine(lineIndex) {
          if (lineIndex < lines.length) {
            const element = document.getElementById('line' + (lineIndex + 1));
            let i = 0;
            const typingInterval = setInterval(() => {
              element.textContent += lines[lineIndex][i];
              i++;
              if (i === lines[lineIndex].length) {
                clearInterval(typingInterval);
                element.classList.remove('typing-effect');
                setTimeout(() => {
                  typeLine(lineIndex + 1); // Type the next line with a delay
                }, sentenceDelay);
              }
            }, typingSpeed);
          } else {
            document.querySelector('.pressyou-any-key').style.opacity = 1;
          }
        }

        setTimeout(() => {
          typeLine(0); // Start typing the first line
        }, 500);
      }
    };
    timeline.push(instructions3);

    const imageBaseURL3 = "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/image/";
    const audioBaseURL3 = "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/audio/";
    const fileExtensionImage3 = ".jpg";
    const fileExtensionAudio3 = ".mp3";

    var preload = {
      type: jsPsychPreload,
      images: [
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/image/1.jpg",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/image/2.jpg",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/image/3.jpg",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/image/4.jpg"
      ],
      audio: [
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/audio/1.mp3",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/audio/2.mp3",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/audio/3.mp3",
        "https://raw.githubusercontent.com/ucsd-psych201a/yu2007/40c37faca733d92b1121274138b7191f2e9e1bf2/stimuli/condition3/audio/4.mp3",
      ]
    };
    timeline.push(preload);

    var countdown_3 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">3</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };

    var countdown_2 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">2</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };

    var countdown_1 = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<div class="countdown-container">1</div>',
      choices: "NO_KEYS",
      trial_duration: 1000
    };
    timeline.push(countdown_3, countdown_2, countdown_1);
    
    function createImageAudioTrial3(image_a, image_b, image_c, image_d, audio_a, audio_b, audio_c, audio_d) {
  var images = [image_a, image_b, image_c, image_d];
  var audios = [audio_a, audio_b, audio_c, audio_d];
  shuffleArray(images);  // Shuffle images
  shuffleArray(audios);  // Shuffle audios

  var preload = {
    type: jsPsychPreload,
    images: images,
    audio: audios
  };

  var imageAudioTrial3= {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <div class="image-container">
        <img src="${images[0]}" alt="Image 1">
        <img src="${images[1]}" alt="Image 2">
        <img src="${images[2]}" alt="Image 3">
        <img src="${images[3]}" alt="Image 4">
      </div>
      <div class="timer">Time Remaining: <span id="timer">6</span> seconds</div>
      <audio id="audio_a">
        <source src="${audios[0]}" type="audio/mp3">
      </audio>
      <audio id="audio_b">
        <source src="${audios[1]}" type="audio/mp3">
      </audio>
      <audio id="audio_c">
        <source src="${audios[2]}" type="audio/mp3">
      </audio>
      <audio id="audio_d">
        <source src="${audios[3]}" type="audio/mp3">
      </audio>
    `,
    choices: "NO_KEYS",
    trial_duration: 12000,
    on_load: () => {
      const audio_a = document.getElementById('audio_a');
      const audio_b = document.getElementById('audio_b');
      const audio_c = document.getElementById('audio_c');
      const audio_d = document.getElementById('audio_d');
      const timerElement = document.getElementById('timer');
      let startTime = Date.now();
      let timeRemaining = 12;

      // Timer countdown logic
      const timerInterval = setInterval(() => {
        let currentTime = Date.now();
        let elapsedTime = Math.floor((currentTime - startTime) / 1000);
        timeRemaining = 12 - elapsedTime;
        timerElement.textContent = timeRemaining;
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
        }
      }, 1000);

      // Sequential audio playback with a gap
      audio_a.play();
      audio_a.onended = function () {
        setTimeout(function () {
          audio_b.play();
        }, 500);
      };
      audio_b.onended = function () {
        setTimeout(function () {
          audio_c.play();
        }, 500);
      };
      audio_c.onended = function () {
        setTimeout(function () {
          audio_d.play();
        }, 500);
      };

      // Error handling
      audio_a.onerror = () => console.error("Error playing audio_a");
      audio_b.onerror = () => console.error("Error playing audio_b");
      audio_c.onerror = () => console.error("Error playing audio_c");
      audio_d.onerror = () => console.error("Error playing audio_d");
    }
  };

  return [preload, imageAudioTrial3];
}


    const trialMappings3 = [
  { trial: 1,  imageA: 1,  imageB: 2,  imageC: 3,  imageD: 4,  audioA: 1,  audioB: 2,  audioC: 3,  audioD: 4 },
  { trial: 2,  imageA: 5,  imageB: 6,  imageC: 7,  imageD: 8,  audioA: 5,  audioB: 6,  audioC: 7,  audioD: 8 },
  { trial: 3,  imageA: 9,  imageB: 10, imageC: 11, imageD: 12, audioA: 9,  audioB: 10, audioC: 11, audioD: 12 },
  { trial: 4,  imageA: 13, imageB: 14, imageC: 15, imageD: 16, audioA: 13, audioB: 14, audioC: 15, audioD: 16 },
  { trial: 5,  imageA: 17, imageB: 18, imageC: 1,  imageD: 2,  audioA: 17, audioB: 18, audioC: 1,  audioD: 2 },
  { trial: 6,  imageA: 3,  imageB: 4,  imageC: 5,  imageD: 6,  audioA: 3,  audioB: 4,  audioC: 5,  audioD: 6 },
  { trial: 7,  imageA: 7,  imageB: 8,  imageC: 9,  imageD: 10, audioA: 7,  audioB: 8,  audioC: 9,  audioD: 10 },
  { trial: 8,  imageA: 11, imageB: 12, imageC: 13, imageD: 14, audioA: 11, audioB: 12, audioC: 13, audioD: 14 },
  { trial: 9,  imageA: 15, imageB: 16, imageC: 17, imageD: 18, audioA: 15, audioB: 16, audioC: 17, audioD: 18 },
  { trial: 10, imageA: 1,  imageB: 3,  imageC: 5,  imageD: 7,  audioA: 1,  audioB: 3,  audioC: 5,  audioD: 7 },
  { trial: 11, imageA: 9,  imageB: 11, imageC: 13, imageD: 15, audioA: 9,  audioB: 11, audioC: 13, audioD: 15 },
  { trial: 12, imageA: 17, imageB: 2,  imageC: 4,  imageD: 6,  audioA: 17, audioB: 2,  audioC: 4,  audioD: 6 },
  { trial: 13, imageA: 8,  imageB: 10, imageC: 12, imageD: 14, audioA: 8,  audioB: 10, audioC: 12, audioD: 14 },
  { trial: 14, imageA: 16, imageB: 18, imageC: 1,  imageD: 3,  audioA: 16, audioB: 18, audioC: 1,  audioD: 3 },
  { trial: 15, imageA: 5,  imageB: 7,  imageC: 9,  imageD: 11, audioA: 5,  audioB: 7,  audioC: 9,  audioD: 11 },
  { trial: 16, imageA: 13, imageB: 15, imageC: 17, imageD: 2,  audioA: 13, audioB: 15, audioC: 17, audioD: 2 },
  { trial: 17, imageA: 4,  imageB: 6,  imageC: 8,  imageD: 10, audioA: 4,  audioB: 6,  audioC: 8,  audioD: 10 },
  { trial: 18, imageA: 12, imageB: 14, imageC: 16, imageD: 18, audioA: 12, audioB: 14, audioC: 16, audioD: 18 },
  { trial: 19, imageA: 1,  imageB: 2,  imageC: 3,  imageD: 4,  audioA: 1,  audioB: 2,  audioC: 3,  audioD: 4 },
  { trial: 20, imageA: 5,  imageB: 6,  imageC: 7,  imageD: 8,  audioA: 5,  audioB: 6,  audioC: 7,  audioD: 8 },
  { trial: 21, imageA: 9,  imageB: 10, imageC: 11, imageD: 12, audioA: 9,  audioB: 10, audioC: 11, audioD: 12 },
  { trial: 22, imageA: 13, imageB: 14, imageC: 15, imageD: 16, audioA: 13, audioB: 14, audioC: 15, audioD: 16 },
  { trial: 23, imageA: 17, imageB: 18, imageC: 1,  imageD: 2,  audioA: 17, audioB: 18, audioC: 1,  audioD: 2 },
  { trial: 24, imageA: 3,  imageB: 4,  imageC: 5,  imageD: 6,  audioA: 3,  audioB: 4,  audioC: 5,  audioD: 6 },
  { trial: 25, imageA: 7,  imageB: 8,  imageC: 9,  imageD: 10, audioA: 7,  audioB: 8,  audioC: 9,  audioD: 10 },
  { trial: 26, imageA: 11, imageB: 12, imageC: 13, imageD: 14, audioA: 11, audioB: 12, audioC: 13, audioD: 14 },
  { trial: 27, imageA: 15, imageB: 16, imageC: 17, imageD: 18, audioA: 15, audioB: 16, audioC: 17, audioD: 18 }
];
   
   const randomizedTrials3 = trialMappings3.sort(() => Math.random() - 0.5);

// Push randomized trials to the timeline
for (let i = 0; i < randomizedTrials3.length; i++) {
    const { imageA, imageB, imageC , imageD, audioA, audioB , audioC, audioD} = randomizedTrials3[i];
      let imageAURL3 = `${imageBaseURL3}${imageA}${fileExtensionImage3}`;
      let imageBURL3= `${imageBaseURL3}${imageB}${fileExtensionImage3}`;
      let imageCURL3= `${imageBaseURL3}${imageC}${fileExtensionImage3}`;
      let imageDURL3= `${imageBaseURL3}${imageD}${fileExtensionImage3}`;
      let audioAURL3 = `${audioBaseURL3}${audioA}${fileExtensionAudio3}`;
      let audioBURL3 = `${audioBaseURL3}${audioB}${fileExtensionAudio3}`;
      let audioCURL3 = `${audioBaseURL3}${audioC}${fileExtensionAudio3}`;
      let audioDURL3= `${audioBaseURL3}${audioD}${fileExtensionAudio3}`;

  timeline.push(...createImageAudioTrial3(imageAURL3, imageBURL3, imageCURL3, imageDURL3,audioAURL3, audioBURL3, audioCURL3,audioDURL3));
}

    jsPsych.run(timeline);

  </script>
</body>

</html>
